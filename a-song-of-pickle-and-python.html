<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="./theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/css/font-awesome.min.css">
  <link href="http://localhost:8000/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Rants of a Troubled Consultant RSS">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
<meta name="author" content="Kalman Olah" />
<meta name="description" content="So here's the setting: you're a handsome, extremely charismatic all-rounder tech-type person. Apparently you're also a bit of a narcissist. On a warm and cosy evening you're sitting in front of your fireplace in your leather armchair sipping on a fine alcoholic beverage of your choice ..." />
<meta name="keywords" content="Horrible, Python">
<meta property="og:site_name" content="Rants of a Troubled Consultant"/>
<meta property="og:title" content="A Song of Pickle and Python"/>
<meta property="og:description" content="So here's the setting: you're a handsome, extremely charismatic all-rounder tech-type person. Apparently you're also a bit of a narcissist. On a warm and cosy evening you're sitting in front of your fireplace in your leather armchair sipping on a fine alcoholic beverage of your choice ..."/>
<meta property="og:locale" content="en_BE"/>
<meta property="og:url" content="./a-song-of-pickle-and-python.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2014-06-17 23:41:56+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/kalman-olah.html">
<meta property="article:section" content="Programming"/>
<meta property="article:tag" content="Horrible"/>
<meta property="article:tag" content="Python"/>
<meta property="og:image" content="/assets/img/stock_photo_of_some_asshole.png">  <title>Rants of a Troubled Consultant &ndash; A Song of Pickle and Python</title>
</head>
<body>
  <aside>
    <div>
      <a href=".">
        <img src="/assets/img/stock_photo_of_some_asshole.png" alt="Rants of a Troubled Consultant" title="Rants of a Troubled Consultant">
      </a>
      <h1><a href=".">Rants of a Troubled Consultant</a></h1>
      <p>Textual output generated by Kalman Olah: a pretty cool tech person who likes automation, game development, hardware, privacy and lazing about.</p>
      <nav>
        <ul class="list">
          <li><a href="./pages/about.html#about">About</a></li>
          <li><a href="https://github.com/kalmanolah/kalmanolah.github.io/tree/source" target="_blank">Source</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-github" href="https://github.com/kalmanolah" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="https://linkedin.com/in/KalmanOlah" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/KalmanOlah" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-envelope-o" href="/assets/misc/pubkey.asc" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/+KalmanOlah1" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-rss" href="/feeds/all.rss" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href=".">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="http://localhost:8000/feeds/all.rss">RSS</a>
    </nav>

<article>
  <header>
    <h1 id="a-song-of-pickle-and-python">A Song of Pickle and Python</h1>
    <p>Posted on Tue 17 June 2014 in <a href="./category/programming.html">Programming</a></p>
  </header>
  <div>
    <p>So here's the setting: you're a handsome, extremely charismatic
all-rounder tech-type person. Apparently you're also a bit of a
narcissist. On a warm and cosy evening you're sitting in front
of your fireplace in your leather armchair sipping on a fine
alcoholic beverage of your choice. As the individual hairs that
make up your beard are swaying in the breeze that
managed to find its way in through your open window, you are struck
by inspiration! Opening <code>$EDITOR</code> (which is <strong>clearly</strong> the
greatest of all text editors) after rushing your way to your
battlestation, you are greeted by this Python3 (because you
don't live in the past, y'know) module:</p>
<div class="highlight"><pre><span class="sd">&quot;&quot;&quot;This is the Thing module.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Thing</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;This class represents a Thing.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">a_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a prop.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_prop</span>

    <span class="nd">@a_prop.setter</span>
    <span class="k">def</span> <span class="nf">a_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a prop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a_prop</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate Thing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_prop</span> <span class="o">=</span> <span class="s">&#39;value&#39;</span>
</pre></div>


<p><em>"Damn, that's some nice pep8/pep257 conformity,"</em> you think to
yourself. "I really am the best." Cursing yourself for letting
your mind wander, you hurriedly open the file you were looking
for. After a bit of buffering that you're not really aware of,
you are presented with yet another module, this time containing
two functions:</p>
<div class="highlight"><pre><span class="sd">&quot;&quot;&quot;This module handles Thing storage and loading.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">storage</span>


<span class="k">def</span> <span class="nf">store_thing</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store an instance of Thing in $BACKEND_STORE.&quot;&quot;&quot;</span>
    <span class="n">serialized_thing</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">serialized_thing</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_things_from_store</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load and return all instances of Thing in $BACKEND_STORE.&quot;&quot;&quot;</span>
    <span class="n">serialized_things</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">load_all</span><span class="p">()</span>
    <span class="n">things</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">serialized_thing</span> <span class="ow">in</span> <span class="n">serialized_thing</span><span class="p">:</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serialized_thing</span><span class="p">)</span>
        <span class="n">things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">things</span>
</pre></div>


<p>You instantly recognize these functions. You wrote them, after all.
You remember <code>store_thing</code> takes an instance of <code>Thing</code> as a parameter
and stores it in <code>$BACKEND_STORE</code>. <code>load_things_from_store</code> fetches all
instances of <code>Thing</code> you've previously stored in <code>$BACKEND_STORE</code> and
returns them.</p>
<p>Glossing over the code, your eyes stop on that familiar word: <em>pickle</em>.
<code>pickle</code> is the library you use for serializing <code>Thing</code> instances in
order to be able to save them and recreate them later.
"Ah <em>pickle</em>, bane of my existence, why must you torment me so?" you
lament. "Were it not for your ease of use and hilarious name, I would
have never had to suffer so!" A few days ago, you decided to add the
property <code>a_prop</code> to your <code>Thing</code> class. At the time you didn't know
your change would completely break the unpickling of your saved
<code>Thing</code> instances that were being loaded from <code>$BACKEND_STORE</code>. "But,
that all ends today!"</p>
<p>You decide that you're going to solve your pickling issues by invoking
two of the darkest magicks in your arsenal: inheritance and functions.
Recalling that Drupal - a PHP CMS/Framework - seems to be alive and
well despite the fact that its users don't know what anything <em>but</em>
functions are, you reckon you should be fine if you take this approach.</p>
<p>Deciding not to procrastinate too much, you manage to quickly add two
methods to your <code>Thing</code> class, making the improved version look like this:</p>
<div class="highlight"><pre><span class="sd">&quot;&quot;&quot;This is the Thing module.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">Thing</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;This class represents a Thing.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">a_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a prop.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a_prop</span>

    <span class="nd">@a_prop.setter</span>
    <span class="k">def</span> <span class="nf">a_prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a prop.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a_prop</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Turn this instance of Thing into plain data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recreate and populate a Thing from existing data.&quot;&quot;&quot;</span>
        <span class="c"># Create a new Thing without calling __init__</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

        <span class="c"># Populate Thing with data</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate Thing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_prop</span> <span class="o">=</span> <span class="s">&#39;value&#39;</span>
</pre></div>


<p>You wipe away the tears that had appeared in the corner of your eye.
Looking toward Dropbox HQ, you solemnly perform a salute and thank
Guido van Rossum for creating such a beautiful work of art.
After contemplating what a world without Python would look like for a moment,
you turn to look at the masterpiece you've written.</p>
<p>The <code>dump</code> method will return a dict containing all of the attributes
of a <code>Thing</code> instance. The <code>load</code> class method can be called without
instantiating a new <code>Thing</code> manually, and will populate a new <code>Thing</code>
instance with existing data without incurring overhead by triggering
the constructor. Furthermore, if you move <code>load</code> and <code>dump</code> into a
class of their own, you can have <code>Thing</code> inherit that class and then
override the methods if needed. This would be useful in the case of
classes where attributes tend to disappear and appear randomly. For
instance, you could implement versioning logic in the <code>load</code> method
based on a <code>version</code> attribute.</p>
<p>At this point, you make a mental note to never use pickle for versioned
objects again.</p>
<p>It's getting late now. You're someone who finishes what they've
started though, so you decide you should see this through until the end.</p>
<p>You decide to update the functions that manage storage of <code>Thing</code>
instances in <code>$BACKEND_STORE</code>. After adding the correct method
calls and replacing pickle with the superior <a href="http://msgpack.org/">msgpack</a>, your fingers
finally relax as you save your module.</p>
<div class="highlight"><pre><span class="sd">&quot;&quot;&quot;This module handles Thing storage and loading.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">msgpack</span>
<span class="kn">import</span> <span class="nn">storage</span>
<span class="kn">import</span> <span class="nn">thing</span>


<span class="k">def</span> <span class="nf">store_thing</span><span class="p">(</span><span class="n">thing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store an instance of Thing in $BACKEND_STORE.&quot;&quot;&quot;</span>
    <span class="n">serialized_thing</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span>
    <span class="n">storage</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">serialized_thing</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_things_from_store</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load and return all instances of Thing in $BACKEND_STORE.&quot;&quot;&quot;</span>
    <span class="n">serialized_things</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">load_all</span><span class="p">()</span>
    <span class="n">things</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">serialized_thing</span> <span class="ow">in</span> <span class="n">serialized_thing</span><span class="p">:</span>
        <span class="n">thing</span> <span class="o">=</span> <span class="n">Thing</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">msgpack</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serialized_thing</span><span class="p">))</span>
        <span class="n">things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">things</span>
</pre></div>


<p>You retire to your chambers for the night, after you quickly write
a completely over the top blog post on the completely trivial and
boring thing you just did.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/horrible.html">Horrible</a>
      <a href="./tag/python.html">Python</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'kalmanolah';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
      <p>&copy; Kalman Olah 2015</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38768307-1', 'auto');
  ga('send', 'pageview');
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "A Song of Pickle and Python",
  "headline": "A Song of Pickle and Python",
  "datePublished": "2014-06-17 23:41:56+02:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Kalman Olah",
    "url": "./author/kalman-olah.html"
  },
  "image": "/assets/img/stock_photo_of_some_asshole.png",
  "url": "./a-song-of-pickle-and-python.html",
  "description": "So here's the setting: you're a handsome, extremely charismatic all-rounder tech-type person. Apparently you're also a bit of a narcissist. On a warm and cosy evening you're sitting in front of your fireplace in your leather armchair sipping on a fine alcoholic beverage of your choice ..."
}
</script></body>
</html>