
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://kalmanolah.net/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://kalmanolah.net/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://kalmanolah.net/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://kalmanolah.net/assets/css/custom.css" rel="stylesheet">


    <link href="https://kalmanolah.net/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Rants of a Troubled Consultant RSS">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />


<meta name="author" content="Kalman Olah" />
<meta name="description" content="I'm of the belief that just about anyone should have the right to expand on the functionality of a FLOSS tool, but I'm also really particular about code style, so I'd rather not deal with a ton of pull requests. I'm a difficulty person. With this ..." />
<meta name="keywords" content="Python">
<meta property="og:site_name" content="Rants of a Troubled Consultant"/>
<meta property="og:title" content="Plugin Discovery Using Entry Points"/>
<meta property="og:description" content="I'm of the belief that just about anyone should have the right to expand on the functionality of a FLOSS tool, but I'm also really particular about code style, so I'd rather not deal with a ton of pull requests. I'm a difficulty person. With this ..."/>
<meta property="og:locale" content="en_BE"/>
<meta property="og:url" content="https://kalmanolah.net/plugin-discovery-using-entry-points.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2014-12-21 23:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://kalmanolah.net/author/kalman-olah.html">
<meta property="article:section" content="Programming"/>
<meta property="article:tag" content="Python"/>
<meta property="og:image" content="/assets/img/stock_photo_of_some_guy.png">

  <title>Rants of a Troubled Consultant &ndash; Plugin Discovery Using Entry Points</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://kalmanolah.net">
        <img src="/assets/img/stock_photo_of_some_guy.png" alt="Rants of a Troubled Consultant" title="Rants of a Troubled Consultant">
      </a>
      <h1><a href="https://kalmanolah.net">Rants of a Troubled Consultant</a></h1>

<p>Textual output generated by Kalman Olah: a pretty cool tech person who likes automation, game development, hardware, privacy and lazing about.</p>
      <nav>
        <ul class="list">
          <li><a href="https://kalmanolah.net/pages/about.html#about">About</a></li>

          <li><a href="https://github.com/kalmanolah/kalmanolah.github.io/tree/source" target="_blank">Source</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="https://github.com/kalmanolah" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-linkedin" href="https://linkedin.com/in/KalmanOlah" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/KalmanOlah" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-envelope-o" href="/assets/misc/pubkey.asc" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-google" href="https://plus.google.com/+KalmanOlah1" target="_blank"><i class="fa fa-google"></i></a></li>
        <li><a class="sc-rss" href="/feeds/all.rss" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://kalmanolah.net">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


      <a href="https://kalmanolah.net/feeds/all.rss">    RSS
</a>
    </nav>

<article class="single">
  <header>
    <h1 id="plugin-discovery-using-entry-points">Plugin Discovery Using Entry Points</h1>
    <p>
          Posted on Sun 21 December 2014 in <a href="https://kalmanolah.net/category/programming.html">Programming</a>


    </p>
  </header>


  <div>
    <p>I'm of the belief that just about anyone should have the right to expand on the
functionality of a FLOSS tool, but I'm also really particular about code style,
so I'd rather not deal with a ton of pull requests. I'm a difficulty person.</p>
<p>With this in mind, a short while ago I was looking for ways to provide users
with the ability to create modules which my tool could then load in at runtime.</p>
<p>Luckily, it turned out <code>$deity</code> had provided us mortals with Python's
<a href="http://pythonhosted.org//setuptools/">setuptools library</a>, which happened to contain the exact features I was
looking for in the form of <a href="https://pythonhosted.org/setuptools/setuptools.html#dynamic-discovery-of-services-and-plugins">entry points</a>.</p>
<p>Entry points are magical little things which allow library authors "plug in" to
your framework/utility, as long as they know your entry point group's name.</p>
<p>Here's a <code>setup.py</code> file for an imaginary <code>text-tool</code> module, which will plug
in to our <code>sweet-tool</code> utility:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;Setup module.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;text-tool&#39;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0.1&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A tool which performs text transformations!&#39;</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="s1">&#39;A tool which performs text transformations!&#39;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;john.doe@example.com&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://github.com/john.doe/text-tool&#39;</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s1">&#39;MIT&#39;</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Development Status :: 2 - Pre-Alpha&#39;</span><span class="p">,</span>
        <span class="s1">&#39;License :: OSI Approved :: MIT License&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;sweet.modules&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;text = text_tool:TextTool&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>


<p>In the code above, we're defining our awesome text module, which can plug its
<code>TextTool</code> class from the <code>text_tool</code> module into the <code>sweet.modules</code> entry
point group, identified by the name <code>text</code>.</p>
<p>Frameworks or pluggable tools can then load these entry points by specifying an
entry point group name.</p>
<p>Here's some example code which will instantiate modules by iterating over a
list of entry points and loading the referenced classes:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">iter_entry_points</span>


<span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;sweet.modules&#39;</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Loading entry point </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">module_class</span> <span class="o">=</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">module_instance</span> <span class="o">=</span> <span class="n">module_class</span><span class="p">()</span>
</pre></div>


<p>Though the code above is useful for illustrating the power of entry points,
it's useful to be able to disable/enable specific modules, as well as reload
them by removing old instances of the module from the python interpreter.</p>
<p>With that in mind, here's the module loader for our <code>sweet-tool</code>:</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Sweet tool module-loading module.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">iter_entry_points</span>


<span class="k">class</span> <span class="nc">ModuleManager</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;The ModuleManager manages the loading of modules.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return modules.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modules</span>

    <span class="nd">@modules.setter</span>
    <span class="k">def</span> <span class="nf">modules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set modules.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modules</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">load_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a module by its identifier.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;sweet.modules&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">identifier</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry_point</span><span class="o">.</span><span class="n">load</span><span class="p">()()</span>

    <span class="k">def</span> <span class="nf">unload_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unload a module by its identifier.&quot;&quot;&quot;</span>
        <span class="c1"># We need to remove the module from the python interpreter in</span>
        <span class="c1"># order for live codebase updates to work.</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">__module__</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load all modules.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry_point</span> <span class="ow">in</span> <span class="n">iter_entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;sweet.modules&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_single</span><span class="p">(</span><span class="n">entry_point</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unload all modules.&quot;&quot;&quot;</span>
        <span class="c1"># We need to copy the list of identifiers, because unloading a</span>
        <span class="c1"># module removes it from the modules dict</span>
        <span class="n">identifiers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">identifiers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unload_single</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start a module by its identifier.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop a module by its identifier.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start all modules.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_single</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop all modules.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_single</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unload</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>


<p>Using the loader above, we could load, unload, start, stop all or specific
modules using only a few lines of code. Furthermore, because we remove the
imported module from <code>sys.modules</code> while unloading a module, reloading module
code without restarting the parent program becomes possible.</p>
<p>Here's a sample:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sweet.modules</span> <span class="kn">import</span> <span class="n">ModuleManager</span>


<span class="n">modules</span> <span class="o">=</span> <span class="n">ModuleManager</span><span class="p">()</span>

<span class="c1"># Load and start all modules</span>
<span class="n">modules</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># Stop and unload all modules</span>
<span class="n">modules</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c1"># Load a specific module by identifier</span>
<span class="n">modules</span><span class="o">.</span><span class="n">load_single</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>

<span class="c1"># Unload a specific module by identifier</span>
<span class="n">modules</span><span class="o">.</span><span class="n">unload_single</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>

<span class="c1"># Reload a module without having to shut down the program</span>
<span class="n">modules</span><span class="o">.</span><span class="n">stop_single</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
<span class="n">modules</span><span class="o">.</span><span class="n">unload_single</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
<span class="n">modules</span><span class="o">.</span><span class="n">load_single</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
<span class="n">modules</span><span class="o">.</span><span class="n">start_single</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
</pre></div>


<p>Conclusion: entry points are amazingly useful. I think the
<a href="http://xkcd.com/353/">xkcd python comic</a> pretty much sums up how I felt after writing the code
above for the first time.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://kalmanolah.net/tag/python.html">Python</a>
    </p>
  </div>




<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'kalmanolah';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>&copy; Kalman Olah 2015 - 2016</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38768307-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Rants of a Troubled Consultant ",
  "url" : "https://kalmanolah.net",
  "image": "/assets/img/stock_photo_of_some_guy.png",
  "description": "Textual output generated by Kalman Olah: a pretty cool tech person who likes automation, game development, hardware, privacy and lazing about."
}
</script>
</body>
</html>